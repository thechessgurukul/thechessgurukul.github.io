<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Game Review | The Chess Gurukul</title>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    
    <style>
        :root {
            --navy: #14213d; --gold: #fca311; --off-white: #f8f9fa; --white: #ffffff;
        }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--off-white); }
        nav { background: var(--navy); padding: 15px 0; color: white; position: sticky; top: 0; z-index: 1000; }
        .nav-container { max-width: 1100px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; }
        .logo { color: var(--gold); font-weight: 800; font-size: 1.4rem; text-decoration: none; }
        .container { max-width: 1100px; margin: 40px auto; padding: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 40px; }
        .board-section { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.05); display: flex; flex-direction: column; align-items: center; }
        .input-section { display: flex; flex-direction: column; gap: 20px; }
        textarea { width: 100%; padding: 15px; border-radius: 10px; border: 1px solid #ddd; font-family: monospace; resize: vertical; }
        .btn-analyze { background: var(--navy); color: white; padding: 15px; border: none; border-radius: 50px; font-weight: 800; cursor: pointer; text-transform: uppercase; transition: 0.3s; }
        .btn-analyze:hover { background: var(--gold); color: var(--navy); }
        #ai-coach-output { background: #fffef0; border: 1px solid var(--gold); padding: 20px; border-radius: 15px; min-height: 150px; }
        @media (max-width: 850px) { .container { grid-template-columns: 1fr; } #board { width: 100% !important; max-width: 350px; } }
    </style>
</head>
<body>

<nav>
    <div class="nav-container">
        <a href="index.html" class="logo">THE CHESS GURUKUL</a>
        <div style="font-weight: 600;">V33 Master Edition</div>
    </div>
</nav>

<div class="container">
    <div class="board-section">
        <h2>Live Game Board</h2>
        <div id="board" style="width: 450px"></div>
        <p style="color: #666; font-size: 0.8rem; margin-top: 10px;">Drag pieces to explore the final position</p>
    </div>

    <div class="input-section">
        <h2>AI Game Review</h2>
        <p>Paste your PGN below to receive coaching from Gemini AI.</p>
        <textarea id="pgnInput" placeholder="e.g. 1. e4 e5 2. Nf3 Nc6..." rows="8"></textarea>
        <button class="btn-analyze" onclick="startAnalysis()">Analyze with Gemini</button>
        <div id="ai-coach-output">
            <strong>âœ¨ Coach Gemini:</strong>
            <p id="coach-text">Waiting for your game data...</p>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>

<script>
    // FIXED: Uses CDN for piece images so they work on GitHub
    var board = Chessboard('board', {
        draggable: true,
        position: 'start',
        pieceTheme: 'https://chessboardjs.com/img/chesspieces/wikipedia/{piece}.png'
    });
    var game = new Chess();

    async function startAnalysis() {
        const pgn = document.getElementById('pgnInput').value;
        const coachBox = document.getElementById('coach-text');

        if (game.load_pgn(pgn)) {
            board.position(game.fen());
            coachBox.innerHTML = "<em>Analyzing critical turning points...</em>";
            
            // Calling the Gemini API
            await fetchGeminiAnalysis(pgn);
        } else {
            alert("Invalid PGN. Please copy a full game log.");
        }
    }

    async function fetchGeminiAnalysis(pgn) {
        // STEP: Replace 'YOUR_KEY' with your actual key from Google AI Studio
        const API_KEY = 'YOUR_GEMINI_API_KEY'; 
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;
        
        const payload = {
            contents: [{
                parts: [{
                    text: "You are an expert chess coach at The Chess Gurukul. Analyze this PGN. Tell the player one thing they did well and one thing they can improve. Keep it under 4 sentences and very encouraging: " + pgn
                }]
            }]
        };

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const data = await response.json();
            document.getElementById('coach-text').innerText = data.candidates[0].content.parts[0].text;
        } catch (error) {
            document.getElementById('coach-text').innerText = "Coach is offline. Check your API Key.";
        }
    }
</script>
</body>
</html>
